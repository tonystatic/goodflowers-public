$(document).ready(function(){function a(a,t){void 0===t&&(t=a.data("default")),!1===t.endsWith(".")&&(t+="."),a.html(t).fadeIn()}function t(a){a.fadeOut(300,function(){$(this).html("")})}$("#donateForm").submit(function(e){e.preventDefault();let n=$(this),i=$("#donateModal"),d=$("#paymentModal"),o=$("#donateError"),s=n.find("#donateSubmitButton"),r=d.find("#paymentForm"),l=d.find("#flowersPreview");s.prop("disabled",!0),t(o),$.post(n.attr("action"),n.serialize(),function(t){if(!0===t.success)if(t.data&&t.data.pay_url&&t.data.paid_url&&t.data.flowers_quantity&&t.data.flowers&&"object"==typeof t.data.flowers){i.modal("hide"),r.attr("action",t.data.pay_url),r.attr("data-paid-action",t.data.paid_url),t.data.flowers.forEach(function(a){l.prepend(`\n                                <div class="flowers-preview__flower" style="background-image: url('${a.image}');"></div>\n                            `)});let a=t.data.flowers_quantity-t.data.flowers.length;a>0&&l.append(`\n                                <span class="flowers-preview__diff"">+${a}</span>\n                            `),d.modal("show")}else a(o);else t.messages&&t.messages.length>0?a(o,t.messages[0]):a(o);s.prop("disabled",!1)},"json")}),$("#paymentForm").submit(function(e){e.preventDefault();let n=$(this),i=$("#paymentError"),d=n.find("#paymentSubmitButton");d.prop("disabled",!0),t(i),$.post(n.attr("action"),n.serialize(),function(t){if(!0===t.success)if(t.data&&t.data.payment_data&&t.data.payment_data.provider_id&&t.data.payment_data.invoice_id&&t.data.payment_data.description&&t.data.payment_data.amount&&t.data.payment_data.currency&&t.data.payment_data.data&&"object"==typeof t.data.payment_data.data){let e=t.data.payment_data;!function(t,e,n,i,d,o,s,r={}){let l=new cp.CloudPayments,p=$("#paymentForm"),c=$("#paymentError"),u=p.find("#paymentSubmitButton");l.charge({publicId:t,invoiceId:e,description:n,amount:i,currency:d,accountId:s,email:o,skin:"mini",data:r,language:"ru-RU"},function(){u.prop("disabled",!0),$.post(p.data("paid-action"),{},function(t){!0===t.success&&t.data.redirect?window.location.replace(t.data.redirect):(t.messages&&t.messages.length>0?a(c,t.messages[0]):a(c),u.prop("disabled",!1))},"json")},function(t){a(c,t)})}(e.provider_id,e.invoice_id,e.description,e.amount,e.currency,e.email,e.user_id,e.data)}else a(i);else t.messages&&t.messages.length>0?a(i,t.messages[0]):a(i);d.prop("disabled",!1)},"json")}),$("#donateModal").on("hidden.bs.modal",function(){let a=$(this).find("#quantityInput");a.val(a.attr("min")).trigger("change")}),$("#paymentModal").on("hidden.bs.modal",function(){$(this).find("#flowersPreview").html(""),$(this).find("#paymentForm").attr("action","").attr("data-paid-action","")}),$("#paymentCounter").each(function(){let a=$(this),t=a.find("#quantityInput"),e=parseInt(t.data("price")),n=a.find(".payment__number--increment"),i=a.find(".payment__number--decrement"),d=t.attr("min"),o=a.find(".payment__sum"),s=$("#donateSubmitButton");t.on("keyup change",function(){($(this).val()<=0||null==$(this).val())&&$(this).val(1),o.find("i").html($(this).val()*e),s.html("Посадить "+$(this).val()+" "+$.declOfNum($(this).val(),["цветок","цветка","цветков"]))}),n.click(function(){let e=parseFloat(t.val())+1;a.find("input").val(e),a.find("input").trigger("change")}),i.click(function(){let e=parseFloat(t.val()),n=e<=d?e:e-1;a.find("input").val(n),a.find("input").trigger("change")})})});
